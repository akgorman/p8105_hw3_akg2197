---
title: "p8105_hw3_akg2197"
author: "Annie Gorman"
date: "2024-10-10"
output: github_document
---

## Loading libraries 

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)

library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 1 
```{r}
library(p8105.datasets)
data("ny_noaa")
```

## Problem 2 
Loading the demographic data:
```{r}
demographic_data = read_csv("nhanes_covar.csv", skip = 4) |>
  janitor::clean_names() |>
  drop_na() |>
  mutate (
    sex = case_when(sex==1~"male", sex==2 ~ "female"), 
    education = case_when(
      education==1 ~ "less than high school",
      education==2 ~ "high school equivalent",
      education==3 ~ "more than high school"),
  education = fct_relevel(education,"less than high school", "high school equivalent", "more than high school" )) 

accelerometer_data = read_csv("nhanes_accel.csv") |>
  janitor::clean_names() |>
  pivot_longer(names_to = "minute", values_to = "MIMS", starts_with("min"), names_prefix = "min") |>
  mutate(minute = as.numeric(minute))

merged_nhanes = demographic_data |>
  left_join(accelerometer_data, by= join_by(seqn)) |>
  relocate(seqn, sex, age, bmi, education) |>
  filter(age>20)
```
We can use this code chunk to examine our datasets:
```{r}
demographic_data
view(demographic_data)

accelerometer_data
view(accelerometer_data)
```
The data are cleaned and we can now move on to visualizing the data. 

We will create a table of men and women in each education category:
```{r}
education_table <- demographic_data |>
  count(education, sex) |>
  pivot_wider(names_from = sex, values_from = n, values_fill = 0) |>
  rename ("Level of Education" = education)
knitr::kable(education_table, format = "markdown", caption = "Age Distributions for Men and Women in Each Education Category")
```
In this table, we can see that for the "less than high school" education category, 28 females and 27 males were documented. For "high school equivalent," 23 females and 36 males were recorded. "More than high school" was the most common education status, with 59 females and 56 males. 

We can also visualize this data of the age distributions for men and women in each education category:
```{r} 
  ggplot(merged_nhanes, aes(x = sex, y = education, fill = sex)) + 
  geom_violin(trim = FALSE, color = "blue", alpha = .5) + 
  scale_fill_viridis_d(option = "plasma") + 
  labs(
    title = "Distribution of Sex by Education Category", 
    x = "Age",
    y = "Education Category",
    fill = "Sex"
  ) +
  theme_minimal() + 
  theme(legend.position = "bottom")
#ASK FOR HELP IN OH
```
We can see from this violin plot that 

Visualization of total activity variable for each participant:
```{r}
merged_nhanes |>
  group_by(seqn, age, education, sex) |>
  summarize(total_act=sum(MIMS)) |>
  ggplot(aes(x = age, y = total_act, color = sex)) + 
  geom_point() +
  facet_grid(. ~ education) +
  labs (
    title = "Total Activity vs Age By Sex and Education Level",
    x = "Age", 
    y = "Total Activity Level",
    color = "Sex"
  ) +
  geom_smooth(se = FALSE) 
#Who is males and who is females???
```
From this plot, we can see that for all levels of education, total activity decreases with increasing age for both males and females.

Now, we will make a three-panel plot that shows the 24-hour activity time courses for each education level and use color to indicate sex:
```{r}
daily_activity <- merged_nhanes |>
  mutate(hour = (minute - 1) / 60) |>
  group_by(seqn, hour, sex, education) |>
  summarise(MIMS = mean(MIMS, na.rm = TRUE), .groups = 'drop')

ggplot(daily_activity, aes(x = hour, y = MIMS, color = sex)) +
  geom_smooth(se = FALSE) +
  facet_grid(. ~ education) +
  labs(
    title = "24-Hour Time Courses for Education Level by Sex",
    x = "Hr",
    y = "Average MIMS",
    color = "Sex"
  ) +
  theme_minimal() +
  scale_color_viridis_d(option = "plasma") +
  theme(legend.position = "bottom")
```
I created this plot by FINISH HERE

## Question 3
Importing, cleaning, and tidying the Citi Bikes data for both Jan and July 2020 and Jan and July 2024:
```{r}
jan2020 = read_csv("citibike/Jan2020Citi.csv.zip") |> 
  janitor::clean_names() |>
  rename(
    ride_type = rideable_type, 
    start_station = start_station_name,
    end_station = end_station_name
  ) |>
  mutate(
    ride_type = str_replace(ride_type, "classic bike", "classic"),
    ride_type = str_replace(ride_type, "electric_bike", "electric"), month = "jan2020"
  )
```
```{r}
july2020 = read_csv("citibike/July 2020 Citi.csv.zip") |>
 janitor::clean_names() |>
  rename(
    ride_type = rideable_type, 
    start_station = start_station_name,
    end_station = end_station_name
  ) |>
  mutate(
    ride_type = str_replace(ride_type, "classic bike", "classic"),
    ride_type = str_replace(ride_type, "electric_bike", "electric"), month = "july2020"
  )
```

```{r}
jan2024 = read_csv("citibike/Jan 2024 Citi.csv.zip") |>
 janitor::clean_names() |>
  rename(
    ride_type = rideable_type, 
    start_station = start_station_name,
    end_station = end_station_name
  ) |>
  mutate(
    ride_type = str_replace(ride_type, "classic bike", "classic"),
    ride_type = str_replace(ride_type, "electric_bike", "electric"), month = "jan2024"
  )
```

```{r}
july2024 = read_csv("citibike/July 2024 Citi.csv.zip") |>
 janitor::clean_names() |>
  rename(
    ride_type = rideable_type, 
    start_station = start_station_name,
    end_station = end_station_name
  ) |>
  mutate(
    ride_type = str_replace(ride_type, "classic bike", "classic"),
    ride_type = str_replace(ride_type, "electric_bike", "electric"), month = "july2024"
  )
```

Now that the data are tidy, we can move onto visualization. 
Reader-friendly table showing the total number of rides in each combination of year and month separating casual riders and Citi Bike members:
